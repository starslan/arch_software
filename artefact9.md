# Артефакт 9: Анализ архитектурных решений

## Часть 1: Нефункциональные требования

### Производительность (Performance)
| Требование              | Значение                     | Реализация                          |
|-------------------------|------------------------------|-------------------------------------|
| Время отклика API       | ≤ 500 мс (p95)               | Кеширование (Redis), оптимизация БД |
| Обработка данных IoT    | ≤ 1 сек (устройство→аналитика)| Буферизация в Kafka, потоковая обработка |
| Пропускная способность  | 10K RPS на API Gateway       | Автомасштабирование (K8s), балансировка |

### Масштабируемость (Scalability)
| Требование              | Значение                     | Реализация                          |
|-------------------------|------------------------------|-------------------------------------|
| Горизонтальное масштабирование | Поддержка 1M+ пользователей | Kubernetes + HPA                   |
| Пиковые нагрузки        | 10K одновременных участников | Serverless-функции для очередей     |
| Геораспределение        | Задержка ≤ 150 мс            | Multi-region развертывание         |

### Безопасность (Security)
| Требование              | Значение                     | Реализация                          |
|-------------------------|------------------------------|-------------------------------------|
| Шифрование данных       | TLS 1.3                      | Let's Encrypt                       |
| Аутентификация          | OAuth 2.0 + JWT              | Keycloak                            |
| Персональные данные     | Хранение в выбранных регионах| Политики в S3/PostgreSQL            |

### Доступность (Availability)
| Требование              | Значение                     | Реализация                          |
|-------------------------|------------------------------|-------------------------------------|
| SLA                     | 99.95% (≤4.38ч простоя/год)  | Балансировка, Rate Limiting        |
| Восстановление          | ≤15 мин для критичных сервисов| Blue-green деплой, бэкапы          |
| Целостность данных      | Потеря ≤0.001% транзакций    | Репликация БД                      |

### Удобство поддержки (Maintainability)
| Аспект        | Требование                          | Инструменты         |
|---------------|-------------------------------------|---------------------|
| Логирование   | Структурированные логи (JSON)       | ELK Stack           |
| Мониторинг    | Метрики по CPU/RAM/Latency          | Prometheus + Grafana|
| CI/CD         | Zero-downtime deployments           | GitHub Actions      |

---

## Часть 2: Архитектурные решения

### Критерии выбора
- **Масштабируемость**: Возможность роста нагрузки
- **Сложность**: Ресурсы на внедрение
- **Стоимость владения**: Инфраструктура + поддержка
- **Безопасность**: Защита данных
- **Производительность**: Скорость обработки

### Выбор БД для User Service
| Критерий       | PostgreSQL       | MongoDB          | DynamoDB             | **Выбор**     |
|----------------|------------------|------------------|----------------------|---------------|
| Масштабируемость | Шардирование    | Горизонтальное   | Автомасштабирование  | **PostgreSQL**|
| Транзакции     | ACID             | Документные      | Ограниченная         | **PostgreSQL**|
| Стоимость      | Средняя         | Средняя          | Дорого (pay-per-req) | **PostgreSQL**|

**Обоснование**: Требования к транзакциям и согласованности данных.

### Выбор API Gateway
| Критерий       | Kong             | AWS API Gateway  | Nginx          | **Выбор** |
|----------------|------------------|------------------|----------------|-----------|
| Гибкость       | Плагины (Lua/Go)| Только AWS       | Базовые функции| **Kong**  |
| Производит.    | 50K RPS          | 10K RPS (дорого) | 100K RPS       | **Kong**  |
| Безопасность   | JWT/OAuth2       | IAM              | Нет встроенной | **Kong**  |

**Обоснование**: Open-source решение с балансом цены и возможностей.

### Выбор обработчика событий
| Критерий       | Apache Kafka     | RabbitMQ         | **Выбор**      |
|----------------|------------------|------------------|----------------|
| Производит.    | 1M сообщ/сек     | 50K сообщ/сек    | **Kafka**      |
| Стоимость      | Свои серверы     | Дешевле          | **Kafka**      |
| Надежность     | Репликации       | Средняя          | **Kafka**      |

**Обоснование**: Требования к масштабируемости и имеющийся опыт.

### Выбор хранилища файлов
| Критерий       | MinIO            | AWS S3           | **Выбор**      |
|----------------|------------------|------------------|----------------|
| Стоимость      | Бесплатно (OSS)  | $0.023/GB/мес    | **MinIO**      |
| Производит.    | До 10K RPS       | До 5K RPS        | **MinIO**      |
| Интеграция     | S3-совместимый   | Нативный SDK     | **MinIO**      |
| Масштабируемость| Ручное шардир.  | Автоматическое   | **AWS S3**     |

**Итог**: **MinIO** для экономии (используются собственные серверы)